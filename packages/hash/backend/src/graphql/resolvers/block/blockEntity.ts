import { ApolloError } from "apollo-server-express";

import { Resolver } from "../../autoGeneratedTypes";
import { DbBlockProperties, DbUnknownEntity } from "../../../types/dbTypes";
import { GraphQLContext } from "../../context";

export const blockEntity: Resolver<
  Promise<DbUnknownEntity>,
  DbBlockProperties,
  GraphQLContext,
  {}
> = async ({ namespaceId, entityId, entityType }, {}, { dataSources }) => {
  const entity = await dataSources.db.getEntity({ namespaceId, id: entityId });
  if (!entity) {
    throw new ApolloError(`Entity id ${entityId} not found`, "NOT_FOUND");
  }
  if (entity.type !== entityType) {
    throw new ApolloError(
      `Expected entity ID ${entityId} to be of type "${entityType}" not "${entity.type}"`
    );
  }

  return entity as DbUnknownEntity;
};
