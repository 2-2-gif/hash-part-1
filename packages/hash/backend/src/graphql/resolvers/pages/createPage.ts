import { entities } from "../../../mockData/entities";
import { DbPage } from "../../../types/dbTypes";
import {
  MutationCreatePageArgs,
  Resolver,
  Visibility,
} from "../../autoGeneratedTypes";
import { GraphQLContext } from "../../context";

export const createPage: Resolver<
  Promise<DbPage>,
  {},
  GraphQLContext,
  MutationCreatePageArgs
> = async (_, { namespaceId, createdById, properties }, { dataSources }) => {

  const entity = await dataSources.db.createEntity({
    namespaceId,
    createdById,
    type: "Page",
    properties: properties,
  });

  const page: DbPage = {
    id: entity.id,
    namespaceId: entity.namespaceId,
    properties: entity.properties,
    createdById: entity.createdById,
    type: "Page",
    updatedAt: entity.updatedAt,
    createdAt: entity.createdAt,
    visibility: Visibility.Public, // TODO
  };

  entities.push(page);  // TODO: remove

  return page;
};
