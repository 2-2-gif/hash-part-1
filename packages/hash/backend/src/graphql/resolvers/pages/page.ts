import { ApolloError } from "apollo-server-express";

import { QueryPageArgs, Resolver } from "../../autoGeneratedTypes";
import { DbPage } from "../../../types/dbTypes";
import { GraphQLContext } from "../../context";

export const page: Resolver<
  Promise<DbPage>,
  {},
  GraphQLContext,
  QueryPageArgs
> = async (_, { namespaceId, id }, { dataSources }) => {
  const entity = await dataSources.db.getEntity({ namespaceId, id });
  if (!entity) {
    throw new ApolloError(`Page id ${id} not found`, "NOT_FOUND");
  }
  if (entity.type !== "Page") {
    throw new ApolloError(`Entity ${id} is type "${entity.type}" not "Page"`);
  }

  return entity as DbPage;
};
