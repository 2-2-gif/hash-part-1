import { VoidFunctionComponent } from "react";
import Link from "next/link";
import { useQuery } from "@apollo/client";

import { getNamespacePages } from "../../../graphql/queries/namespace.queries";
import {
  GetNamespacePagesQuery,
  GetNamespacePagesQueryVariables,
} from "../../../graphql/autoGeneratedTypes";

import styles from "./PageSidebar.module.scss";

type NamespacePageListProps = {
  namespaceId: string;
  currentPageId: string;
};

export const NamespacePageList: VoidFunctionComponent<NamespacePageListProps> =
  ({ currentPageId, namespaceId }) => {
    const { data } = useQuery<
      GetNamespacePagesQuery,
      GetNamespacePagesQueryVariables
    >(getNamespacePages, {
      variables: { namespaceId },
    });

    return (
      <div>
        {data?.namespacePages.map((page) => {
          if (page.id === currentPageId) {
            return <div>{page.properties.title}</div>;
          }
          return (
            <Link href={`/${namespaceId}/${page.id}`} key={page.id}>
              <a>{page.properties.title}</a>
            </Link>
          );
        })}
      </div>
    );
  };
