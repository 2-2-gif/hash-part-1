import { VoidFunctionComponent } from "react";
import Link from "next/link";
import { useRouter } from "next/router";
import { useQuery } from "@apollo/client";

import { getNamespacePages } from "../../graphql/queries/namespace.queries";
import {
  GetNamespacePagesQuery,
  GetNamespacePagesQueryVariables,
} from "../../graphql/autoGeneratedTypes";

import styles from "../index.module.scss";

export const NamespaceHome: VoidFunctionComponent = () => {
  const { query } = useRouter();
  const namespaceId = query.namespaceId as string;

  const { data } = useQuery<
    GetNamespacePagesQuery,
    GetNamespacePagesQueryVariables
  >(getNamespacePages, {
    variables: { namespaceId },
  });

  return (
    <main className={styles.Main}>
      <header>
        <h1>Pages in namespace {namespaceId}</h1>
      </header>
      <ul>
        {data?.namespacePages.map((page) => (
          <li key={page.id}>
            <Link href={`/pages/${page.id}`}>
              <a>{page.properties.title}</a>
            </Link>
          </li>
        ))}
      </ul>
    </main>
  );
};

export default NamespaceHome;
